(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     27197,        830]
NotebookOptionsPosition[     24345,        777]
NotebookOutlinePosition[     24954,        798]
CellTagsIndexPosition[     24911,        795]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Quasi-Newton Updates", "Title",
 CellChangeTimes->{{3.8465884180627756`*^9, 3.846588429089326*^9}, {
  3.84666883912605*^9, 3.846668864267633*^9}, {3.8826172645175605`*^9, 
  3.8826172694218645`*^9}, {3.882619601837344*^9, 3.882619604388424*^9}, {
  3.883646802202586*^9, 3.8836468102774763`*^9}, {3.8836477552815256`*^9, 
  3.8836477602280865`*^9}, {3.9483772009708986`*^9, 
  3.948377216562624*^9}},ExpressionUUID->"bb443c9e-1a1c-437e-b10c-\
400e63a30bb8"],

Cell[TextData[{
 "The idea behind Quasi-Newton updates is to approximate the Hessian (second \
derivative) using information from changes in the gradient (first \
derivative).  This is information that we are already evaluating.  As we will \
see the update equations (called the Second Condition) give ",
 Cell[BoxData[
  FormBox["n", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "462e96d4-725b-40ff-97dc-38f8b2790206"],
 " equations (one vectors worth) in the ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"n", "(", 
     RowBox[{"n", "-", "1"}], ")"}], "/", "2"}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "45b0f43f-26c4-4d63-a99b-34b4fbaaad5a"],
 " entries of a symmetric approximation to a Hessian. "
}], "Text",
 CellChangeTimes->{{3.8836472316959257`*^9, 3.8836472482550077`*^9}, {
  3.8836475490566807`*^9, 3.8836477480633497`*^9}, {3.9476690841856475`*^9, 
  3.9476691470700026`*^9}, {3.948377251035412*^9, 
  3.9483774652747297`*^9}},ExpressionUUID->"ac8f2459-c5b6-46e8-8ae2-\
62f95df6ae3c"],

Cell[TextData[{
 "We are stepping from ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["x", "k"], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "4a028ece-cc14-4a9f-be41-7ef6e367c209"],
 " to ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["x", 
    RowBox[{"k", "+", "1"}]], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "803f81c6-ba08-476a-a5b6-f485c26268a5"],
 ".  \nThe step ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["s", "k"], "=", 
    RowBox[{
     SubscriptBox["x", 
      RowBox[{"k", "+", "1"}]], "-", 
     SubscriptBox["x", "k"]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "566550bb-3878-4e42-8000-ecddeabc6096"],
 ", "
}], "Text",
 CellChangeTimes->{{3.9483774692122526`*^9, 3.9483775431784506`*^9}, 
   3.9483776778279953`*^9},ExpressionUUID->"f08da879-3669-4147-84e0-\
ba8131a84a42"],

Cell[TextData[{
 "We have the gradient ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[Del]", 
     SubscriptBox["f", "k"]}], "=", 
    RowBox[{"\[Del]", 
     RowBox[{"f", "(", 
      SubscriptBox["x", "k"], ")"}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "10029a56-8708-4cd4-95e2-633d57b6f492"],
 " and compute the new gradient ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[Del]", 
     SubscriptBox["f", 
      RowBox[{"k", "+", "1"}]]}], "=", 
    RowBox[{"\[Del]", 
     RowBox[{"f", "(", 
      SubscriptBox["x", 
       RowBox[{"k", "+", "1"}]], ")"}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "e21a85a5-a682-4f44-865f-25319a307287"],
 ".  \nThe change in gradient is ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["y", "k"], "=", 
    RowBox[{
     RowBox[{"\[Del]", 
      SubscriptBox["f", 
       RowBox[{"k", "+", "1"}]]}], "-", 
     RowBox[{"\[Del]", 
      SubscriptBox["f", "k"]}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "33e530b3-7ca2-490c-a41e-a5dd0b88b78b"],
 ". "
}], "Text",
 CellChangeTimes->{{3.9483774692122526`*^9, 
  3.9483776879724407`*^9}},ExpressionUUID->"872722fc-9388-4ca3-9f42-\
ccd6fd409420"],

Cell[TextData[{
 "If ",
 Cell[BoxData[
  FormBox[
   RowBox[{"f", "=", 
    RowBox[{
     RowBox[{"0.5", 
      RowBox[{"x", ".", 
       SubscriptBox["B", 
        RowBox[{"k", "+", "1"}]], ".", "x"}]}], "+", 
     RowBox[{
      RowBox[{"\[Del]", 
       SubscriptBox["f", "0"]}], ".", "x"}], "+", 
     SubscriptBox["f", "0"]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "7ecb3d27-e5e2-408d-8216-59134959a3bf"],
 " then ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[Del]", 
     RowBox[{"f", "(", "x", ")"}]}], "=", 
    RowBox[{
     RowBox[{"B", ".", "x"}], "+", 
     RowBox[{"\[Del]", 
      SubscriptBox["f", "0"]}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "052f8dbf-f1f0-4a79-8682-6aad81dc9615"],
 " and we should have\n\t",
 Cell[BoxData[
  FormBox[GridBox[{
     {
      RowBox[{"\[Del]", 
       SubscriptBox["f", "k"]}], "=", 
      RowBox[{"B", ".", 
       SubscriptBox["x", "k"]}], "+", 
      RowBox[{"\[Del]", 
       SubscriptBox["f", "0"]}]},
     {
      RowBox[{"\[Del]", 
       SubscriptBox["f", 
        RowBox[{"k", "+", "1"}]]}], "=", 
      RowBox[{"B", ".", 
       SubscriptBox["x", 
        RowBox[{"k", "+", "1"}]]}], 
      RowBox[{" ", "+"}], 
      RowBox[{" ", 
       RowBox[{"\[Del]", 
        SubscriptBox["f", "0"]}]}]}
    }], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "39746ebb-52c4-4c57-abd6-d54b57045e1b"],
 "\nSubtracting gives the Second Condition\n\t",
 Cell[BoxData[
  FormBox[GridBox[{
     {
      RowBox[{
       SubscriptBox["B", 
        RowBox[{"k", "+", "1"}]], "(", 
       RowBox[{
        SubscriptBox["x", 
         RowBox[{"k", "+", "1"}]], "-", 
        SubscriptBox["x", "k"]}], ")"}], "=", 
      RowBox[{
       RowBox[{"\[Del]", 
        SubscriptBox["f", 
         RowBox[{"k", "+", "1"}]]}], "-", 
       RowBox[{"\[Del]", 
        SubscriptBox["f", "k"]}]}]}
    }], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "3552f61a-ec8c-408b-b2a1-d6f424d79ad8"],
 "\nor equivalently\n(Sec)\t",
 Cell[BoxData[
  FormBox[GridBox[{
     {
      RowBox[{
       SubscriptBox["B", 
        RowBox[{"k", "+", "1"}]], 
       SubscriptBox["s", "k"]}], "=", 
      SubscriptBox["y", "k"]}
    }], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "69643884-8720-48f1-8fc6-cccfcde87cda"],
 "."
}], "Text",
 CellChangeTimes->{{3.948377702860325*^9, 3.948377968492237*^9}, {
  3.948378026020347*^9, 
  3.948378027403654*^9}},ExpressionUUID->"90a156ef-d705-41e0-bacd-\
36b6cabf24c1"],

Cell[TextData[{
 "The symmetric ",
 Cell[BoxData[
  FormBox[
   RowBox[{"n", "\[Times]", "n"}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "8d6909ad-6d99-4c03-b4c8-4ab6c67e9fa7"],
 " matrix ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["B", 
    RowBox[{"k", "+", "1"}]], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "92fb9016-0c84-4167-aa45-4cc00b849d51"],
 " has ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"n", "(", 
     RowBox[{"n", "-", "1"}], ")"}], "/", "2"}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "f8853656-6501-48a8-a396-4952a176c491"],
 " or roughly ",
 Cell[BoxData[
  FormBox[
   RowBox[{"0.5", 
    SuperscriptBox["n", "2"]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "14372b8f-21ee-452a-821c-0bf1cfac9678"],
 " entries. The Secant Condition is ",
 Cell[BoxData[
  FormBox["n", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "1fe76f3f-fba1-4301-8536-f7f80c88fb3f"],
 " linear equations. The Secant condition does not determine the new \
approximation ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["B", 
    RowBox[{"k", "+", "1"}]], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "993210a6-222c-43cd-92fa-65db6c633efe"],
 ".  There are lots of Quasi-Newton update schemes!"
}], "Text",
 CellChangeTimes->{{3.948377702860325*^9, 
  3.9483781583482184`*^9}},ExpressionUUID->"46a633c3-41fa-4afd-befc-\
021498e7c630"],

Cell[CellGroupData[{

Cell["SR1", "Subsection",
 CellChangeTimes->{{3.9483786082635827`*^9, 
  3.948378608947703*^9}},ExpressionUUID->"a2984306-507b-405d-a08b-\
aca0ab216d9f"],

Cell[TextData[{
 "The algebraically simplest is called SR1.  SR1 stands for Symmetric Rank \
One and updates an olde estimate ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["B", "k"], TraditionalForm]],ExpressionUUID->
  "c739e102-a9b5-4f78-999b-cc39a459c3a7"],
 " with a rank one matrix constructed from a single vector ",
 Cell[BoxData[
  FormBox["w", TraditionalForm]],ExpressionUUID->
  "cd4acb68-53ce-4675-98bb-12409a40fb44"],
 ".  In other words, \n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["B", 
     RowBox[{"k", "+", "1"}]], "=", 
    RowBox[{
     SubscriptBox["B", "k"], "+", 
     RowBox[{"w", "\[CircleTimes]", "w"}]}]}], TraditionalForm]],
  ExpressionUUID->"b020bebc-66b9-470b-bda3-903965fb5ecd"],
 "\nThe advantages are that ",
 Cell[BoxData[
  FormBox["w", TraditionalForm]],ExpressionUUID->
  "b70b7c68-30c6-4844-941d-6b6d44142114"],
 " is uniquely determined from ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["s", "k"], TraditionalForm]],ExpressionUUID->
  "7f04b190-3321-40c4-a87a-2baa8af85af7"],
 " and",
 Cell[BoxData[
  FormBox[
   SubscriptBox["y", "k"], TraditionalForm]],ExpressionUUID->
  "3139effd-fe50-498e-b47c-bd6e365f7178"],
 " and the approximation can approximate non SPD Hessians.  The disadvantages \
are that there is no way to enforce a positive definite update and the update \
could well be large.    "
}], "Text",
 CellChangeTimes->{{3.948378161106904*^9, 3.9483784846183157`*^9}, {
  3.948388640856707*^9, 
  3.948388641264403*^9}},ExpressionUUID->"caa31591-abda-47e7-9db2-\
ba85fea45156"]
}, Open  ]],

Cell[CellGroupData[{

Cell["SR1", "Subsection",
 CellChangeTimes->{{3.9483786082635827`*^9, 
  3.948378608947703*^9}},ExpressionUUID->"94daa045-5431-4157-8944-\
8f9de7cacb0b"],

Cell[TextData[{
 "The algebraically simplest is called SR1.  SR1 stands for Symmetric Rank \
One and updates an olde estimate ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["B", "k"], TraditionalForm]],ExpressionUUID->
  "2e9c1d8e-85df-42fe-9424-dd54b6b1a21f"],
 " with a rank one matrix constructed from a single vector ",
 Cell[BoxData[
  FormBox["w", TraditionalForm]],ExpressionUUID->
  "98552c64-fd28-4c05-b35b-497e9aa0c20d"],
 ".  In other words, \n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["B", 
     RowBox[{"k", "+", "1"}]], "=", 
    RowBox[{
     SubscriptBox["B", "k"], "+", 
     RowBox[{"w", "\[CircleTimes]", "w"}]}]}], TraditionalForm]],
  ExpressionUUID->"fec1fb6c-14fa-4889-a35b-dc3163628f26"],
 "\nThe advantages are that ",
 Cell[BoxData[
  FormBox["w", TraditionalForm]],ExpressionUUID->
  "fae52c0a-61d7-4305-942e-a8fc28bb0e53"],
 " is uniquely determined from ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["s", "k"], TraditionalForm]],ExpressionUUID->
  "6e92a16b-439d-49a8-92d8-a6fca7a1a5a8"],
 " and",
 Cell[BoxData[
  FormBox[
   SubscriptBox["y", "k"], TraditionalForm]],ExpressionUUID->
  "04b391bd-084c-4905-bfe7-75847ad07bac"],
 " and the approximation can approximate non SPD Hessians.  The disadvantages \
are that the update could well be very large and there is no way to enforce a \
positive definite update.    "
}], "Text",
 CellChangeTimes->{{3.948378161106904*^9, 3.9483784846183157`*^9}, {
  3.948378619674615*^9, 
  3.9483786545436873`*^9}},ExpressionUUID->"dda35396-be53-49b6-a134-\
fea4beb5bcc9"],

Cell[TextData[{
 "The derivation for w is pretty simple. We will do it on the board.   The \
result is\n\t ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["B", 
     RowBox[{"k", "+", "1"}]], "=", 
    RowBox[{
     SubscriptBox["B", "k"], "+", 
     FractionBox[
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["y", "k"], "-", 
         RowBox[{
          SubscriptBox["B", "k"], 
          SubscriptBox["s", "k"]}]}], ")"}], "\[CircleTimes]", 
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["y", "k"], "-", 
         RowBox[{
          SubscriptBox["B", "k"], 
          SubscriptBox["s", "k"]}]}], ")"}]}], 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["y", "k"], "-", 
         RowBox[{
          SubscriptBox["B", "k"], 
          SubscriptBox["s", "k"]}]}], ")"}], ".", 
       SubscriptBox["s", "k"]}]]}]}], TraditionalForm]],ExpressionUUID->
  "700c6630-1092-49be-a1ff-b58f3edd32c6"],
 "\nThere is an equivalent update for ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["H", "k"], "=", 
    SubsuperscriptBox["B", "k", 
     RowBox[{"-", "1"}]]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "b7df2053-296d-49be-9862-45472893993f"],
 " which is \n\t ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["H", 
     RowBox[{"k", "+", "1"}]], "=", 
    RowBox[{
     SubscriptBox["H", "k"], "+", 
     FractionBox[
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["s", "k"], "-", 
         RowBox[{
          SubscriptBox["H", "k"], 
          SubscriptBox["y", "k"]}]}], ")"}], "\[CircleTimes]", 
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["s", "k"], "-", 
         RowBox[{
          SubscriptBox["H", "k"], 
          SubscriptBox["y", "k"]}]}], ")"}]}], 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["s", "k"], "-", 
         RowBox[{
          SubscriptBox["H", "k"], 
          SubscriptBox["y", "k"]}]}], ")"}], ".", 
       SubscriptBox["y", "k"]}]]}]}], TraditionalForm]],ExpressionUUID->
  "99161d74-ce68-416c-b3e2-c5974e1e5444"],
 "\nYou can derive the inverse formula just like the original or use the \
Sherman Morrison formula. "
}], "Text",
 CellChangeTimes->{{3.948436325379244*^9, 3.9484366214091463`*^9}, {
  3.948436656832845*^9, 
  3.9484367136680627`*^9}},ExpressionUUID->"01d57139-8dc7-42a9-99a2-\
c25e18cbdce1"],

Cell["\<\
https://en.wikipedia.org/wiki/Sherman%E2%80%93Morrison_formula\
\>", "Text",
 CellChangeTimes->{
  3.9484367015162325`*^9},ExpressionUUID->"1393b44a-37b1-4da8-804c-\
e9367accf722"],

Cell["https://en.wikipedia.org/wiki/Symmetric_rank-one", "Text",
 CellChangeTimes->{
  3.948389493184692*^9},ExpressionUUID->"6b09d6fd-6839-40d0-b84c-\
f3c8caa746cd"]
}, Open  ]],

Cell[CellGroupData[{

Cell["BFGS and DFP", "Subsection",
 CellChangeTimes->{{3.9483786082635827`*^9, 3.948378608947703*^9}, {
  3.94837866547857*^9, 
  3.948378668747239*^9}},ExpressionUUID->"0c2b9aba-b899-49f1-8666-\
e11e2bd113e8"],

Cell[TextData[{
 "The most common update (default in most software) is BFGS.  The original \
Quasi-Newton update is DFP.  Both are algebraically clean rank two updates.  \
Both were motivated by scale invariance arguments. Both have justifications \
as minimizing the change from ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["B", "k"], TraditionalForm]],ExpressionUUID->
  "d22240cc-120d-4dda-a524-4e9dc864a4f6"],
 "\nBFGS:\t",
 Cell[BoxData[
  FormBox[GridBox[{
     {
      SubscriptBox["B", 
       RowBox[{"k", "+", "1"}]], "=", 
      SubscriptBox["B", "k"], "+", 
      FractionBox[
       RowBox[{
        SubscriptBox["y", "k"], "\[CircleTimes]", 
        SubscriptBox["y", "k"]}], 
       RowBox[{
        SubscriptBox["y", "k"], ".", 
        SubscriptBox["s", "k"]}]], "-", 
      FractionBox[
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          SubscriptBox["B", "k"], 
          SubscriptBox["s", "k"]}], ")"}], "\[CircleTimes]", 
        RowBox[{"(", 
         RowBox[{
          SubscriptBox["B", "k"], 
          SubscriptBox["s", "k"]}], ")"}]}], 
       RowBox[{
        SubscriptBox["s", "k"], ".", 
        RowBox[{"(", 
         RowBox[{
          SubscriptBox["B", "k"], 
          SubscriptBox["s", "k"]}], ")"}]}]]}
    }], TraditionalForm]],ExpressionUUID->
  "0227a5a9-c3ed-47aa-b72c-f4a1a90e0487"],
 " \nDFP:    \t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["B", 
     RowBox[{"k", "+", "1"}]], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"I", "-", 
        RowBox[{
         SubscriptBox["\[Rho]", "k"], 
         RowBox[{
          SubscriptBox["y", "k"], "\[CircleTimes]", 
          SubscriptBox["s", "k"]}]}]}], ")"}], 
      RowBox[{
       RowBox[{
        SubscriptBox["B", "k"], "(", 
        RowBox[{"I", "-", 
         RowBox[{
          SubscriptBox["\[Rho]", "k"], 
          RowBox[{
           SubscriptBox["y", "k"], "\[CircleTimes]", 
           SubscriptBox["s", "k"]}]}]}], ")"}], "\[Transpose]"}]}], "+", 
     RowBox[{
      SubscriptBox["\[Rho]", "k"], 
      RowBox[{
       SubscriptBox["y", "k"], "\[CircleTimes]", 
       SubscriptBox["y", "k"]}]}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "b2d422fe-e153-4be8-bf0c-5a7358ce3f9e"],
 "\nwith ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Rho]", "k"], "=", 
    RowBox[{"1", "/", 
     RowBox[{
      SubscriptBox["y", "k"], ".", 
      SubscriptBox["s", "k"]}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "f9d5c3a7-81ba-45ce-a2f0-e8999cf60d55"],
 "."
}], "Text",
 CellChangeTimes->{{3.948378161106904*^9, 3.9483784846183157`*^9}, {
  3.948378619674615*^9, 3.948379032310707*^9}, {3.9483886892940545`*^9, 
  3.9483890798255453`*^9}, {3.9483892753578362`*^9, 
  3.948389300418658*^9}},ExpressionUUID->"d292243d-80a6-4dc3-b71f-\
db9b7c766919"],

Cell[TextData[{
 "You also frequently see update formulas for ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["H", "k"], "=", 
    SuperscriptBox[
     RowBox[{"(", 
      SubscriptBox["B", "k"], ")"}], 
     RowBox[{"-", "1"}]]}], TraditionalForm]],ExpressionUUID->
  "dec4d243-a062-414b-8b5e-aaa8256f065a"],
 ".  It is not an accident that these look like flipped around\nBFGS:\t",
 Cell[BoxData[
  FormBox[GridBox[{
     {
      SubscriptBox["H", 
       RowBox[{"k", "+", "1"}]], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"I", "-", 
          RowBox[{
           SubscriptBox["\[Rho]", "k"], 
           RowBox[{
            SubscriptBox["s", "k"], "\[CircleTimes]", 
            SubscriptBox["y", "k"]}]}]}], ")"}], 
        RowBox[{
         SubscriptBox["H", "k"], "(", 
         RowBox[{"I", "-", 
          RowBox[{
           SubscriptBox["\[Rho]", "k"], 
           RowBox[{
            SubscriptBox["s", "k"], "\[CircleTimes]", 
            SubscriptBox["y", "k"]}]}]}], ")"}]}], "+", 
       RowBox[{
        SubscriptBox["\[Rho]", "k"], 
        RowBox[{
         SubscriptBox["y", "k"], "\[CircleTimes]", 
         SubscriptBox["y", "k"]}]}]}]}
    }], TraditionalForm]],ExpressionUUID->
  "65367407-d7b0-4978-9cf2-ed886a872d4a"],
 " \nDFP:    \t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["H", 
     RowBox[{"k", "+", "1"}]], "=", GridBox[{
      {
       SubscriptBox["H", "k"], "+", 
       FractionBox[
        RowBox[{
         SubscriptBox["s", "k"], "\[CircleTimes]", 
         SubscriptBox["s", "k"]}], 
        RowBox[{
         SubscriptBox["y", "k"], ".", 
         SubscriptBox["s", "k"]}]], "-", 
       FractionBox[
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           SubscriptBox["H", "k"], 
           SubscriptBox["y", "k"]}], ")"}], "\[CircleTimes]", 
         RowBox[{"(", 
          RowBox[{
           SubscriptBox["H", "k"], 
           SubscriptBox["y", "k"]}], ")"}]}], 
        RowBox[{
         SubscriptBox["y", "k"], ".", 
         RowBox[{"(", 
          RowBox[{
           SubscriptBox["H", "k"], 
           SubscriptBox["y", "k"]}], ")"}]}]]}
     }]}], TraditionalForm]],ExpressionUUID->
  "bba230a5-1a0f-4d11-8364-8dc940a6cc07"],
 " \nwith ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Rho]", "k"], TraditionalForm]],ExpressionUUID->
  "b26312b1-4988-4314-aa99-fe5e003e1893"],
 " as before. The H versions come from the Sherman Morrison formula.  In \
specific and relevant ways these are minimal change formulas.  "
}], "Text",
 CellChangeTimes->{{3.948378161106904*^9, 3.9483784846183157`*^9}, {
  3.948378619674615*^9, 3.948379032310707*^9}, {3.9483886892940545`*^9, 
  3.948389047778803*^9}, {3.948389121247789*^9, 3.9483891401873875`*^9}, {
  3.94838918434085*^9, 3.9483892410280895`*^9}, {3.948389304981476*^9, 
  3.9483893094358053`*^9}, {3.948436724313854*^9, 
  3.948436780569146*^9}},ExpressionUUID->"721b8e4a-99b0-46f3-9ff7-\
3cd01b85534b"],

Cell["\<\
https://en.wikipedia.org/wiki/Broyden%E2%80%93Fletcher%E2%80%93Goldfarb%E2%80%\
93Shanno_algorithm\
\>", "Text",
 CellChangeTimes->{
  3.9483894217154584`*^9},ExpressionUUID->"e73d7790-14e7-4161-a890-\
563f07eb4064"],

Cell["\<\
https://en.wikipedia.org/wiki/Davidon%E2%80%93Fletcher%E2%80%93Powell_formula\
\>", "Text",
 CellChangeTimes->{3.9483894217154584`*^9, 
  3.948389452340864*^9},ExpressionUUID->"5bfb785a-c98d-4db8-8a53-\
bbbd150d1ccb"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Checking", "Section",
 CellChangeTimes->{{3.9483893352006054`*^9, 
  3.9483893409346676`*^9}},ExpressionUUID->"111545dd-dcb8-4bce-acec-\
3ce0436a5181"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SR1BUpdate", "[", 
   RowBox[{"B_", ",", 
    RowBox[{"{", 
     RowBox[{"s_", ",", "y_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"r", "=", 
      RowBox[{"y", "-", 
       RowBox[{"B", ".", "s"}]}]}], "}"}], ",", 
    RowBox[{"B", "+", " ", 
     FractionBox[
      RowBox[{"KroneckerProduct", "[", 
       RowBox[{"r", ",", " ", "r"}], "]"}], 
      RowBox[{"r", ".", "s"}]]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.948436269945277*^9, 3.948436295051819*^9}, {
   3.9484368365407667`*^9, 3.948437170529006*^9}, 
   3.948437254988266*^9},ExpressionUUID->"b66a991e-2569-4c86-bec0-\
0823e3c683ca"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"n", "=", "12"}], ";", " ", 
  RowBox[{"g", "=", 
   RowBox[{"RandomReal", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"B", "=", 
   RowBox[{"RandomReal", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"B", "=", 
   RowBox[{"B", "+", 
    RowBox[{"B", "\[Transpose]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"df", "[", "x_", "]"}], ":=", 
  RowBox[{
   RowBox[{"B", ".", "x"}], "+", "g"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"B0", "=", 
   RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"x0", ",", "x1"}], "}"}], "=", 
   RowBox[{"RandomReal", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "n"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"s0", "=", 
   RowBox[{"x1", "-", "x0"}]}], ";", 
  RowBox[{"y0", "=", 
   RowBox[{
    RowBox[{"df", "[", "x1", "]"}], "-", 
    RowBox[{"df", "[", "x0", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"B1", "=", 
   RowBox[{"SR1BUpdate", "[", 
    RowBox[{"B0", ",", 
     RowBox[{"{", 
      RowBox[{"s0", ",", "y0"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Norm", "[", 
  RowBox[{
   RowBox[{"B1", ".", "s0"}], "-", "y0"}], "]"}]}], "Input",
 CellChangeTimes->{{3.948436269945277*^9, 3.948436295051819*^9}, {
   3.9484368365407667`*^9, 3.948437170529006*^9}, 
   3.948437254988266*^9},ExpressionUUID->"bcc1abaf-ee60-43b1-b45d-\
ba027015c8f1"],

Cell[BoxData["1.4602703977091186`*^-15"], "Output",
 CellChangeTimes->{{3.948437046744464*^9, 3.9484370802926164`*^9}, {
  3.9484371155627193`*^9, 3.9484371714166636`*^9}},
 CellLabel->"Out[69]=",ExpressionUUID->"ed370812-f600-406f-b346-bc04846e3d77"]
}, Open  ]]
}, Open  ]],

Cell["Performance and Behavior", "Section",
 CellChangeTimes->{{3.9483893352006054`*^9, 
  3.9483893609186325`*^9}},ExpressionUUID->"5bf5bd2a-dd26-4c21-bb1b-\
e5d89549dc35"]
}, Open  ]]
},
WindowToolbars->"EditBar",
WindowSize->{979, 603},
WindowMargins->{{Automatic, -1042.5}, {360, Automatic}},
TaggingRules-><|
 "PresenterSettings" -> <|"Dialogs" -> {}|>, "TryRealOnly" -> False|>,
Magnification->1.25,
FrontEndVersion->"13.3 for Microsoft Windows (64-bit) (July 24, 2023)",
StyleDefinitions->FrontEnd`FileName[{"PresenterTools"}, "Aqua.nb", 
  CharacterEncoding -> "UTF-8"],
ExpressionUUID->"acd303b3-7ae7-4b29-b581-592687bcb8f3"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 464, 7, 294, "Title",ExpressionUUID->"bb443c9e-1a1c-437e-b10c-400e63a30bb8"],
Cell[1047, 31, 1058, 23, 125, "Text",ExpressionUUID->"ac8f2459-c5b6-46e8-8ae2-62f95df6ae3c"],
Cell[2108, 56, 880, 29, 69, "Text",ExpressionUUID->"f08da879-3669-4147-84e0-ba8131a84a42"],
Cell[2991, 87, 1249, 42, 69, "Text",ExpressionUUID->"872722fc-9388-4ca3-9f42-ccd6fd409420"],
Cell[4243, 131, 2566, 89, 198, "Text",ExpressionUUID->"90a156ef-d705-41e0-bacd-36b6cabf24c1"],
Cell[6812, 222, 1482, 46, 97, "Text",ExpressionUUID->"46a633c3-41fa-4afd-befc-021498e7c630"],
Cell[CellGroupData[{
Cell[8319, 272, 153, 3, 60, "Subsection",ExpressionUUID->"a2984306-507b-405d-a08b-aca0ab216d9f"],
Cell[8475, 277, 1547, 42, 181, "Text",ExpressionUUID->"caa31591-abda-47e7-9db2-ba85fea45156"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10059, 324, 153, 3, 60, "Subsection",ExpressionUUID->"94daa045-5431-4157-8944-8f9de7cacb0b"],
Cell[10215, 329, 1554, 42, 181, "Text",ExpressionUUID->"dda35396-be53-49b6-a134-fea4beb5bcc9"],
Cell[11772, 373, 2432, 79, 170, "Text",ExpressionUUID->"01d57139-8dc7-42a9-99a2-c25e18cbdce1"],
Cell[14207, 454, 190, 5, 41, "Text",ExpressionUUID->"1393b44a-37b1-4da8-804c-e9367accf722"],
Cell[14400, 461, 166, 3, 41, "Text",ExpressionUUID->"6b09d6fd-6839-40d0-b84c-f3c8caa746cd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14603, 469, 210, 4, 59, "Subsection",ExpressionUUID->"0c2b9aba-b899-49f1-8666-e11e2bd113e8"],
Cell[14816, 475, 2869, 89, 188, "Text",ExpressionUUID->"d292243d-80a6-4dc3-b71f-db9b7c766919"],
Cell[17688, 566, 2979, 88, 188, "Text",ExpressionUUID->"721b8e4a-99b0-46f3-9ff7-3cd01b85534b"],
Cell[20670, 656, 226, 6, 69, "Text",ExpressionUUID->"e73d7790-14e7-4161-a890-563f07eb4064"],
Cell[20899, 664, 227, 5, 41, "Text",ExpressionUUID->"5bfb785a-c98d-4db8-8a53-bbbd150d1ccb"]
}, Open  ]],
Cell[CellGroupData[{
Cell[21163, 674, 157, 3, 80, "Section",ExpressionUUID->"111545dd-dcb8-4bce-acec-3ce0436a5181"],
Cell[21323, 679, 690, 20, 56, "Input",ExpressionUUID->"b66a991e-2569-4c86-bec0-0823e3c683ca"],
Cell[CellGroupData[{
Cell[22038, 703, 1837, 59, 202, "Input",ExpressionUUID->"bcc1abaf-ee60-43b1-b45d-ba027015c8f1"],
Cell[23878, 764, 251, 3, 40, "Output",ExpressionUUID->"ed370812-f600-406f-b346-bc04846e3d77"]
}, Open  ]]
}, Open  ]],
Cell[24156, 771, 173, 3, 80, "Section",ExpressionUUID->"5bf5bd2a-dd26-4c21-bb1b-e5d89549dc35"]
}, Open  ]]
}
]
*)

